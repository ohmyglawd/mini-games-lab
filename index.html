<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¯æ„›å°‘å¥³æ”¾ç½®éŠæˆ² v0.1</title>
    <style>
      :root {
        color-scheme: dark;
        --bg1: #1f1147;
        --bg2: #0f172a;
        --card: rgba(26, 32, 64, 0.78);
        --line: #475569;
        --text: #f8fafc;
        --soft: #cbd5e1;
        --pink: #f472b6;
        --pink2: #ec4899;
        --mint: #34d399;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Noto Sans TC", Inter, system-ui, -apple-system, sans-serif;
        background: radial-gradient(circle at top, var(--bg1), var(--bg2) 60%);
        color: var(--text);
      }
      .screen {
        min-height: 100vh;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }
      .screen.active { display: flex; }
      .panel {
        width: min(760px, 94vw);
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: 22px;
        padding: 24px;
        box-shadow: 0 18px 50px rgba(0,0,0,.35);
      }
      h1, h2, p { margin: 0; }
      .title { font-size: clamp(1.7rem, 3vw, 2.2rem); margin-bottom: 12px; }
      .sub { color: var(--soft); margin-bottom: 18px; line-height: 1.6; }
      .menu-buttons, .row { display: grid; gap: 12px; }
      .menu-buttons { margin-top: 14px; }
      button {
        border: none;
        border-radius: 14px;
        padding: 12px 16px;
        font-size: 1rem;
        font-weight: 700;
        color: #071021;
        background: linear-gradient(135deg, var(--pink), var(--pink2));
        cursor: pointer;
      }
      button.alt { background: #334155; color: var(--text); }
      button.good { background: linear-gradient(135deg, #6ee7b7, var(--mint)); }
      button:disabled { opacity: .45; cursor: not-allowed; }
      .game-grid {
        display: grid;
        gap: 18px;
        grid-template-columns: 1fr;
      }
      .topbar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: space-between;
        align-items: center;
      }
      .stats {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .chip {
        background: rgba(15, 23, 42, .88);
        border: 1px solid #334155;
        border-radius: 999px;
        padding: 8px 12px;
        font-size: .92rem;
      }
      .girl-wrap {
        text-align: center;
        border: 1px dashed #64748b;
        border-radius: 18px;
        padding: 16px;
        background: rgba(15, 23, 42, .5);
      }
      #girlButton {
        width: min(300px, 75vw);
        background: transparent;
        border: none;
        cursor: pointer;
        transition: transform .08s ease;
        padding: 0;
      }
      #girlButton:active { transform: scale(.97); }
      .girl-svg {
        width: 100%;
        height: auto;
        filter: drop-shadow(0 10px 24px rgba(0,0,0,.35));
      }
      #stageLabel { margin-top: 6px; color: var(--soft); }
      .hint { color: var(--soft); font-size: .9rem; margin-top: 8px; }
      .toast {
        margin-top: 10px;
        color: #0f172a;
        background: #fef08a;
        border-radius: 10px;
        padding: 8px 10px;
        display: none;
      }
      .toast.show { display: inline-block; }
    </style>
  </head>
  <body>
    <section id="menuScreen" class="screen active">
      <div class="panel">
        <h1 class="title">ğŸ® å¯æ„›å°‘å¥³æ”¾ç½®éŠæˆ²</h1>
        <p class="sub">å–®æ©Ÿç‰ˆåŸå‹ï¼šæ¯åˆ†é˜è‡ªå‹• +1 åˆ†ï¼Œä¹Ÿå¯æ‰‹å‹•é»æ“Šå°‘å¥³ +1 åˆ†ã€‚</p>
        <div class="menu-buttons">
          <button id="newGameBtn" class="good">æ–°éŠæˆ²</button>
          <button id="loadGameBtn">è®€å–éŠæˆ²</button>
          <button id="exitBtn" class="alt">é€€å‡ºéŠæˆ²</button>
        </div>
        <p class="hint">æç¤ºï¼šæœƒè‡ªå‹•å­˜æª”åœ¨æœ¬æ©Ÿç€è¦½å™¨ï¼ˆlocalStorageï¼‰ã€‚</p>
        <p id="menuToast" class="toast"></p>
      </div>
    </section>

    <section id="gameScreen" class="screen">
      <div class="panel game-grid">
        <div class="topbar">
          <h2>ğŸ’– å°‘å¥³é¤Šæˆä¸­</h2>
          <div class="stats">
            <span class="chip">ç©åˆ†ï¼š<strong id="scoreText">0</strong></span>
            <span class="chip">è‡ªå‹•åŠ åˆ†ï¼šæ¯åˆ†é˜ +1</span>
          </div>
        </div>

        <div class="girl-wrap">
          <button id="girlButton" aria-label="é»æ“Šå°‘å¥³åŠ åˆ†"></button>
          <p id="stageLabel">åˆå§‹å‹æ…‹ï¼ˆ0~10ï¼‰</p>
          <p class="hint">é»æˆ‘ä¸€ä¸‹ +1 åˆ†</p>
        </div>

        <div class="row">
          <button id="saveBtn" class="good">æ‰‹å‹•å­˜æª”</button>
          <button id="backBtn" class="alt">è¿”å›ä¸»é¸å–®</button>
        </div>
      </div>
    </section>

    <script>
      const SAVE_KEY = "mini_games_idle_girl_save_v1";
      const AUTO_GAIN_MS = 60_000;

      const menuScreen = document.getElementById("menuScreen");
      const gameScreen = document.getElementById("gameScreen");
      const scoreText = document.getElementById("scoreText");
      const stageLabel = document.getElementById("stageLabel");
      const girlButton = document.getElementById("girlButton");
      const menuToast = document.getElementById("menuToast");

      let state = { score: 0, updatedAt: Date.now() };
      let timer = null;

      const STAGES = [
        { min: 0, max: 10, style: "seed", label: "åˆå§‹å‹æ…‹ï¼ˆ0~10ï¼‰" },
        { min: 11, max: 20, style: "mid", label: "ä¸­éšå‹æ…‹ï¼ˆ11~20ï¼‰" },
        { min: 21, max: 30, style: "final", label: "æœ€çµ‚å‹æ…‹ï¼ˆ21~30ï¼‰" }
      ];

      function girlSvg(style) {
        const hair = style === "final" ? "#c084fc" : style === "mid" ? "#f472b6" : "#60a5fa";
        const bow = style === "final" ? "#facc15" : style === "mid" ? "#fb7185" : "#a78bfa";
        const aura = style === "final" ? "#fde68a" : style === "mid" ? "#f9a8d4" : "#93c5fd";
        return `
          <svg class="girl-svg" viewBox="0 0 260 320" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="äºŒæ¬¡å…ƒå¯æ„›å°‘å¥³">
            <defs>
              <radialGradient id="bgAura" cx="50%" cy="40%" r="60%">
                <stop offset="0%" stop-color="${aura}" stop-opacity="0.45"/>
                <stop offset="100%" stop-color="#000" stop-opacity="0"/>
              </radialGradient>
            </defs>
            <ellipse cx="130" cy="150" rx="95" ry="110" fill="url(#bgAura)"/>
            <path d="M68 120 C72 58, 188 58, 192 120 L192 205 C184 250, 76 250, 68 205 Z" fill="${hair}"/>
            <circle cx="130" cy="145" r="52" fill="#fde7d7"/>
            <circle cx="110" cy="142" r="11" fill="#1f2937"/>
            <circle cx="151" cy="142" r="11" fill="#1f2937"/>
            <circle cx="106" cy="138" r="3" fill="#fff"/>
            <circle cx="147" cy="138" r="3" fill="#fff"/>
            <path d="M112 169 Q130 183 148 169" stroke="#fb7185" stroke-width="5" fill="none" stroke-linecap="round"/>
            <ellipse cx="95" cy="156" rx="9" ry="6" fill="#fda4af" opacity="0.75"/>
            <ellipse cx="166" cy="156" rx="9" ry="6" fill="#fda4af" opacity="0.75"/>
            <path d="M82 205 C100 188, 160 188, 178 205 L188 282 H72 Z" fill="#f8fafc"/>
            <path d="M120 206 L140 206 L135 282 L125 282 Z" fill="${bow}" opacity="0.9"/>
            <path d="M90 98 L70 82 L92 78 Z" fill="${bow}"/>
            <path d="M170 98 L190 82 L168 78 Z" fill="${bow}"/>
          </svg>`;
      }

      function showScreen(screen) {
        menuScreen.classList.remove("active");
        gameScreen.classList.remove("active");
        screen.classList.add("active");
      }

      function getStage(score) {
        if (score >= 21) return STAGES[2];
        if (score >= 11) return STAGES[1];
        return STAGES[0];
      }

      function clampScore(score) {
        return Math.max(0, Math.min(30, score));
      }

      function render() {
        state.score = clampScore(state.score);
        const stage = getStage(state.score);
        scoreText.textContent = state.score;
        stageLabel.textContent = stage.label;
        girlButton.innerHTML = girlSvg(stage.style);
      }

      function saveGame(showMsg = false) {
        state.updatedAt = Date.now();
        localStorage.setItem(SAVE_KEY, JSON.stringify(state));
        if (showMsg) toast("å·²å­˜æª” âœ¨");
      }

      function loadGame() {
        const raw = localStorage.getItem(SAVE_KEY);
        if (!raw) return null;
        try {
          const parsed = JSON.parse(raw);
          if (typeof parsed.score !== "number") return null;
          return {
            score: clampScore(parsed.score),
            updatedAt: typeof parsed.updatedAt === "number" ? parsed.updatedAt : Date.now()
          };
        } catch {
          return null;
        }
      }

      function applyOfflineGain() {
        const now = Date.now();
        const elapsed = now - state.updatedAt;
        if (elapsed <= 0) return;
        const gain = Math.floor(elapsed / AUTO_GAIN_MS);
        if (gain > 0) state.score = clampScore(state.score + gain);
        state.updatedAt = now;
      }

      function startGameLoop() {
        stopGameLoop();
        timer = setInterval(() => {
          state.score = clampScore(state.score + 1);
          render();
          saveGame(false);
        }, AUTO_GAIN_MS);
      }

      function stopGameLoop() {
        if (timer) {
          clearInterval(timer);
          timer = null;
        }
      }

      function toast(msg) {
        menuToast.textContent = msg;
        menuToast.classList.add("show");
        clearTimeout(toast._t);
        toast._t = setTimeout(() => menuToast.classList.remove("show"), 1800);
      }

      function enterGame(fromLoad = false) {
        if (fromLoad) applyOfflineGain();
        render();
        showScreen(gameScreen);
        startGameLoop();
      }

      document.getElementById("newGameBtn").addEventListener("click", () => {
        state = { score: 0, updatedAt: Date.now() };
        saveGame(false);
        document.getElementById("loadGameBtn").disabled = false;
        enterGame(false);
      });

      document.getElementById("loadGameBtn").addEventListener("click", () => {
        const loaded = loadGame();
        if (!loaded) {
          toast("æ‰¾ä¸åˆ°å­˜æª”ï¼Œè«‹å…ˆå»ºç«‹æ–°éŠæˆ²ï½");
          return;
        }
        state = loaded;
        enterGame(true);
      });

      document.getElementById("exitBtn").addEventListener("click", () => {
        toast("å·²é€€å‡ºï¼ˆç›®å‰ç¶²é ç‰ˆç„¡æ³•ç›´æ¥é—œé–‰åˆ†é ï¼‰");
      });

      girlButton.addEventListener("click", () => {
        state.score = clampScore(state.score + 1);
        render();
        saveGame(false);
      });

      document.getElementById("saveBtn").addEventListener("click", () => saveGame(true));

      document.getElementById("backBtn").addEventListener("click", () => {
        saveGame(false);
        stopGameLoop();
        showScreen(menuScreen);
      });

      // åˆå§‹ UI
      render();
      if (!loadGame()) {
        document.getElementById("loadGameBtn").disabled = true;
      }
      window.addEventListener("beforeunload", () => saveGame(false));
    </script>
  </body>
</html>
